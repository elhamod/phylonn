program: main.py
# name: sweep1
project: Phylo-VQVAE
command:
  - ${env}
  - ${interpreter}
  - ${program}
  - "-t"
  - "True"
  - "--gpus"
  - "0,"
  - "--name"
  - "Phylo-VQVAE"
  - "--prefix"
  - "/fastscratch/elhamod"
  - ${args_no_hyphens}
method: bayes
metric:
  goal: minimize
  name: "val/disentangler_phylo_loss"
  target: 0.15
# early_terminate:
#   type: hyperband
#   max_iter: 20
#   s: 2
#   eta: 2
parameters:
  model:
    parameters:
      base_learning_rate: 
        distribution: constant
        value: 4.5e-6
      target: 
        distribution: constant
        value: taming.models.phyloautoencoder.PhyloVQVAE
      
      params:
        parameters:
          ckpt_path: 
            distribution: constant
            value: /fastscratch/elhamod/projects/taming-transformers/logs/256pixels_256embedding/checkpoints/last.ckpt
          embed_dim:
            distribution: constant
            value: 256
          n_embed:
            distribution: constant
            value: 1024

          ddconfig:
            parameters:
              double_z:
                distribution: constant
                value: False
              z_channels: 
                distribution: constant
                value: 256
              resolution:
                distribution: constant
                value: 256
              in_channels:
                distribution: constant
                value: 3
              out_ch:
                distribution: constant
                value: 3
              ch:
                distribution: constant
                value: 128
              ch_mult: 
                distribution: constant
                value: [ 1,1,2,2,4]  # num_down = len(ch_mult)-1
              num_res_blocks:
                distribution: constant
                value: 2
              attn_resolutions:
                distribution: constant
                value: [16]
              dropout:
                distribution: constant
                value: 0.0
          lossconfig:
            parameters:
              target: 
                distribution: constant
                value: taming.modules.losses.DummyLoss
          phylomodel_params:
            parameters:
              embed_dim:
                distribution: constant
                value: 16
              n_embed:
                distribution: constant
                value: 64
              #
              n_phylolevels: 
                distribution: constant
                value: 4
              n_levels_non_attribute: 
                distribution: constant
                value: 40
              codebooks_per_phylolevel:
                distribution: categorical
                values:
                - 4
                - 8
              #
              n_phylo_channels:
                distribution: categorical
                values:
                - 32
                - 64
              # NOT hyperparameters.
              resolution:
                distribution: constant
                value: 16
              in_channels:
                distribution: constant
                value: 256
              out_ch:
                distribution: constant
                value: 256
              ch:
                distribution: constant
                value: 256

              lossconfig:
                parameters:
                  target: 
                    distribution: constant
                    value: taming.modules.losses.vqperceptual.VQLPIPSWithDiscriminator
                  params:
                    parameters:
                      codebook_weight:
                        distribution: constant
                        value: 1.0
                      disc_in_channels:
                        distribution: constant
                        value: 0
                      disc_num_layers:
                        distribution: constant
                        value: 0
                      disc_weight:
                        distribution: constant
                        value: 0.0
                      disc_factor:
                        distribution: constant
                        value: 0.0
                      perceptual_weight:
                        distribution: constant
                        value: 0.0
                      disc_start: 
                        distribution: constant
                        value: 10000
              
              lossconfig_kernelorthogonality:
                parameters:
                  target: 
                    distribution: constant
                    value: taming.modules.losses.orthogonalloss.OrthogonalLoss
                  params:
                    parameters:
                      weight:                        
                        distribution: categorical
                        values: 
                        - 0.0
                        - 1.0
              
              lossconfig_anticlassification:
                parameters:
                  target: 
                    distribution: constant
                    value: taming.modules.losses.anticlassificationloss.AntiClassificationLoss
                  params:
                    parameters:
                      weight:
                        distribution: categorical
                        values: 
                        - 0.0
                        - 0.1
                        - 0.3
                        - 1.0
              
              lossconfig_phylo:
                parameters:
                  target: 
                    distribution: constant
                    value: taming.modules.losses.phyloloss.PhyloLoss
                  params:
                    parameters:
                      phylo_weight:
                        distribution: categorical
                        values:
                        - 0.1
                        - 1.0
                      phyloDistances_string:
                        distribution: constant
                        value: "0.77,0.5,0.33"
                      use_multiclass:
                        distribution: categorical
                        values:
                        - True
                        - False
                      fc_layers:
                        distribution: constant
                        value: 3
                      phylogenyconfig:
                        parameters:
                          target:
                            distribution: constant
                            value: taming.data.phylogeny.Phylogeny
                          params:
                            parameters:
                              filePath:
                                distribution: constant
                                value: /fastscratch/elhamod/data/Fish
  data:
    parameters:
      target: 
        distribution: constant
        value: main.DataModuleFromConfig
      params:
        parameters:
          batch_size:
            distribution: constant
            value: 5
          num_workers:
            distribution: constant
            value: 8
          train:
            parameters:
              target: 
                distribution: constant
                value: taming.data.custom.CustomTrain
              params:
                parameters:
                  training_images_list_file: 
                    distribution: constant
                    value: /fastscratch/elhamod/data/Fish/taming_transforms_fish_train_padded_256.txt
                  size:
                    distribution: constant
                    value: 256
                  add_labels: 
                    distribution: constant
                    value: true

          validation:
            parameters:
              target:
                distribution: constant
                value: taming.data.custom.CustomTest
              params:
                parameters:
                  test_images_list_file: 
                    distribution: constant
                    value: /fastscratch/elhamod/data/Fish/taming_transforms_fish_test_padded_256.txt
                  size:
                    distribution: constant
                    value: 256
                  add_labels: 
                    distribution: constant
                    value: true
  lightning:
    parameters:
      trainer:
        parameters:
          max_epochs:
            distribution: constant
            value: 200
          # profiler: 
          #   distribution: constant
          #   value: simple